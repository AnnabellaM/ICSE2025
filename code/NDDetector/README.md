# NDDetector

NDDetector (Non-determinism detector) is a flexible tool that can be used to detect non-deterministic behaviors in configurable static analysis on a variety of benchmarks.
NDDetector can be extended to use alternative analyses, but currently, it can run 
call graph analyses using WALA, SOOT, DOOP, OPAL, TAJS, PyCG, and Code2Flow, taint analysis on Android applications using FlowDroid, AmanDroid, and DroidSafe, as well as vulnerability detection on C programs using Infer.

# Experiments for Artifact Review
To maintain the anonymity of the submission, we have anonymized links that we use to access external tools and benchmarks. Therefore, the full experiments are not functional in this version of the artifact. We plan to make a submission to the artifact evaluation track upon acceptance of our paper with all the experiments working.

For this version of the artifact, we have made the analysis tool FlowDroid available, as well as the benchmark 'icse25-ezbench', which comprises four programs from the DroidBench 3.0 benchmark. **After following the instructions in [INSTALL.md](INSTALL.md)**, you can run this experiment with the following command:

`dispatcher -t flowdroid -b icse25-ezbench --tasks taint -i 5`

where `-i 5` can be configured to the number of iterations you wish to run. This will create a `results` folder. Details on how to read the contents of this folder are below.

## How to Read NDDetector Output

By default, NDDetector creates a *results* folder for its results, but the location of the results can be controlled with the `--results-location` option.

We explain the results of NDDetector through the example above, where we run FlowDroid on the `icse25-ezbench` benchmark.

```commandline
results
|- flowdroid
|  |- icse25-ezbench
|  |  |- iteration0
|  |  |  |- configurations
|  |  |  |  |- 1e9c00f5704518e138859b037784c841
|  |  |  |  |- 3d42058705611ed0e83612b6dff38a35
|  |  |  |  |- ...
|  |  |  |- .1e9c00f5704518e138859b037784c841_JavaThread2-debug.apk.raw.log
|  |  |  |- .1e9c00f5704518e138859b037784c841_JavaThread2-debug.apk.raw.time
|  |  |  |- .3d42058705611ed0e83612b6dff38a35_JavaThread2-debug.apk.raw.log
|  |  |  |- .3d42058705611ed0e83612b6dff38a35_JavaThread2-debug.apk.raw.time
|  |  |  |- ...
|  |  |  |- 1e9c00f5704518e138859b037784c841_JavaThread2-debug.apk.raw
|  |  |  |- 3d42058705611ed0e83612b6dff38a35_JavaThread2-debug.apk.raw
|  |  |  |- ...
|- non-determinism
|  |- flowdroid
|  |  |- icse25-ezbench
|  |  |  |- 7b5480bdb06b2ff39ebfb2bcedd2f657_JavaThread2.apk.raw
|  |  |  |  |- run-0
|  |  |  |  |- run-1
|  |  |  |  |- ...
```

The results of each iteration are stored in their respective folders. For each configuration-program pair, three files are generated, each with a different extension: `.raw`, `.raw.log`, and `.raw.time`. These files correspond to the results produced by the tool, which will be processed by the *ToolReader* implementation, the log for each experiment, and the execution time for each experiment, respectively.

Configurations in the results are represented as hash values. You can see what configuration a hash value represents by looking in the configuration folder. In this example, configuration 1e9c00f5704518e138859b037784c841 corresponds to the configuration `--aplength 10 --cgalgo RTA --nothischainreduction --dataflowsolver CONTEXTFLOWSENSITIVE --aliasflowins --singlejoinpointabstraction --staticmode CONTEXTFLOWSENSITIVE --nostatic --codeelimination PROPAGATECONSTS --implicit ALL --callbackanalyzer FAST --maxcallbackspercomponent 1 --maxcallbacksdepth 1 --enablereflection --pathalgo CONTEXTSENSITIVE --taintwrapper NONE`

The results of non-determinism detection can be found in the `non-determinism` folder. This folder maintains all non-deterministic results across 5 iterations, each batch of results is stored under a folder named as `configration-hash_apk-name.apk.raw`.

In our example, one detected non-determinism is on `JavaThread2.apk` under configuration  `7b5480bdb06b2ff39ebfb2bcedd2f657`.

## Post-processing Results

We provide a post-processing script, [scripts/analysis/post_process.py](scripts/analysis/post_process.py). To execute this step, navigate to the `scripts/analysis` directory and run the following command:

```
python post_process.py --path <path-to-non_determinism-folder> <tool> <benchmark>
```

This command generates a CSV file in the `results/postprocess` folder, aggregating all results for the specified tool-benchmark pair. It also calculates the percentage of consistent results and the number of distinct results.

We run this script for every tool-benchmark pair and compile the results into `ICSE2025_AGGREGATE_DATA.csv`.

Additionally, we provide a Jupyter notebook, [scripts/notebooks/graphs.ipynb](scripts/notebooks/graphs.ipynb), to generate figures 3 and 4 for `RQ2.2`. This notebook requires `ICSE2025_AGGREGATE_DATA.csv` as input, containing all results from the CSVs generated by the `post_process.py` script. It is designed to work with the complete dataset, including non-determinism data from all eight tools discussed in the paper.